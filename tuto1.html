<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Crappy: How to use C++ designed hardware drivers with Crappy ?</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Crappy
   </div>
   <div id="projectbrief">Control and Real-time Acquisition Parralellized in PYthon</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('tuto1.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">How to use C++ designed hardware drivers with Crappy ? </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>There is lot of hardware only available for C++ or C platforms, but it can be easily bound with Python. Here we will give you an example on how to bind C language to make it object oriented (as we use to in Python).</p>
<h1>how to bind C/C++ with Crappy? </h1>
<p>This gives a complete example on how to bind C and C++ language with Python and add it to the Crappy package. Linux and Windows are both used for building.</p>
<dl class="section warning"><dt>Warning</dt><dd>This is not a C++ tutorial, some notion are used here, please refer to the tutorials below if you are not a C or C++ developer. /n C++ tutorials: <ul>
<li>
<a href="https://openclassrooms.com/courses/programmez-avec-le-langage-c">openclassrooms (fr) </a>  </li>
<li>
<a href="http://www.cplusplus.com/doc/tutorial/">cplusplus (en) </a>  </li>
</ul>
C tutorials: <ul>
<li>
<a href="https://openclassrooms.com/courses/apprenez-a-programmer-en-c">openclassroom (fr) </a>  </li>
<li>
<a href="http://www.cprogramming.com/tutorial/c-tutorial.html">cprogramming (en) </a>  </li>
</ul>
</dd></dl>
<p>Under Linux, you must install the python-dev package to ensure that you can use the Python.h library in the C or C++ code.</p>
<div class="fragment"><div class="line">sudo apt-<span class="keyword">get</span> install python-dev</div>
</div><!-- fragment --><p>Under Windows, there is no python-dev package, but the python installer for windows will install a subdirectory in the python dir directory:</p>
<ul>
<li>C:\Python\include which contains the Python.h.</li>
</ul>
<h2>First example </h2>
<h3>The C++ code (<a class="el" href="hello_8cpp.html">hello.cpp</a>)</h3>
<div class="fragment"><div class="line"><span class="comment">// Python header contains all the functions definitions to handle python object in C/C++.</span></div>
<div class="line"><span class="preprocessor">#include &lt;Python.h&gt;</span></div>
<div class="line"><span class="comment">// Header that defines the standard input/output stream objects.</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// define the namespace to use.</span></div>
<div class="line"><span class="keyword">using namespace </span>std;</div>
<div class="line"></div>
<div class="line"><span class="comment">// The functions bound with python have to return a PyObject understandable in Python.</span></div>
<div class="line"><span class="keyword">static</span> PyObject* hello(PyObject* <span class="keyword">self</span>, PyObject* args){</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="namespaceread.html#a7a73642afd2005a0b413c43879edf4ef">name</a>;</div>
<div class="line">    <span class="comment">// it parse the args argument and look for a string</span></div>
<div class="line">    <span class="comment">// and set the name var with the parsed value.</span></div>
<div class="line">    <span class="comment">// if it fails, PyArg_ParseTuple return False, True otherwise.</span></div>
<div class="line">    <span class="comment">// returning NULL directly allows to raise an exception in Python.</span></div>
<div class="line">    <span class="keywordflow">if</span>(!PyArg_ParseTuple(args, <span class="stringliteral">&quot;s&quot;</span>, &amp;name))</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Hello &quot;</span> &lt;&lt; name &lt;&lt; endl;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// This should be a void function, so we return the Python None.</span></div>
<div class="line">    Py_RETURN_NONE;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// definition of a PyMethodDef object (defined in the python library)</span></div>
<div class="line"><span class="comment">// contains the functions definition to be bound with python.</span></div>
<div class="line"><span class="keyword">static</span> PyMethodDef HelloMethods[] =</div>
<div class="line">{</div>
<div class="line">    {<span class="stringliteral">&quot;hello&quot;</span>, hello, METH_VARARGS, <span class="stringliteral">&quot;Say hello to somebody.&quot;</span>},</div>
<div class="line">    {NULL, NULL, 0, NULL}</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">PyMODINIT_FUNC <a class="code" href="hello_8cpp.html#a299f88d32b419fc587777a87d32b3797">inithelloModule</a>(<span class="keywordtype">void</span>){</div>
<div class="line">    (void) Py_InitModule(<span class="stringliteral">&quot;helloModule&quot;</span>, HelloMethods);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Each functions to bind have to return a PyObject pointer. Then, if a function needs to get arguments, there a passed to args, and first parsed in the function with PyArgs_ParseTuple. If the argument parsed is not a char it return NULL, returning a NULL alows to directly raise a python error. Here there is no need to return an object, so we return None (equivalent of C++ NULL).</p>
<p>Then, to bind the hello function we need to create a PyMethodDef which contains the function definition: </p>
<div class="fragment"><div class="line">{<span class="stringliteral">&quot;hello&quot;</span>, hello, METH_VARARGS, <span class="stringliteral">&quot;Say hello to somebody.&quot;</span>}</div>
</div><!-- fragment --><p>The first element will be the name of the function in python. The second element is the function to bind. The third element is METH_VARARGS if the function get arguments, or METH_NOARGS otherwise. The last element correspond to a description of the function, to appear in the function help.</p>
<h3>Adding the binding to Crappy </h3>
<p>To use the hello method defined in <a class="el" href="hello_8cpp.html">hello.cpp</a>, we need to compile our project. This is automatically supported by the distutil package used to create the Crappy package.</p>
<p>We have to use the Extension module in distulil.core.</p>
<p>Example:</p>
<div class="fragment"><div class="line">helloModule = Extension(<span class="stringliteral">&#39;technical.helloModule&#39;</span>,</div>
<div class="line">                     sources=[<span class="stringliteral">&#39;sources/hello/hello.cpp&#39;</span>],</div>
<div class="line">                     extra_compile_args=[<span class="stringliteral">&quot;-l&quot;</span>, <span class="stringliteral">&quot;python2.7&quot;</span>])</div>
<div class="line"></div>
<div class="line"><a class="code" href="namespacesetup.html#a0903581b09cb42b54fea54f70d48ea4f">extentions</a>.append(helloModule)</div>
</div><!-- fragment --><p>Extension take several argument, the first one is the full name of the extension, including any packages. Not a filename or pathname, but Python dotted name. Here we want to put the extension in technical, to import our module as crappy.technical.helloModule, so the extension name is 'technical.helloModule'.</p>
<dl class="section note"><dt>Note</dt><dd>Here, we called the extension helloModule, so the init method defined must be defined like follow: <div class="fragment"><div class="line">PyMODINIT_FUNC <a class="code" href="hello_8cpp.html#a299f88d32b419fc587777a87d32b3797">inithelloModule</a>(<span class="keywordtype">void</span>){</div>
<div class="line">    (void) Py_InitModule(<span class="stringliteral">&quot;helloModule&quot;</span>, HelloMethods);</div>
<div class="line">}</div>
</div><!-- fragment --><ul>
<li>the name of the function must be: init+[the name of your extension]: inithelloModule.</li>
<li>Py_initModule must initialize a module with the same name "hellModule".</li>
</ul>
</dd></dl>
<p>extensions is just a list containing all the extensions to build, so we must add the helloModule to it.</p>
<p>finally, we import our module in technical/__init__.py.</p>
<p>Now we can build our module with:</p>
<div class="fragment"><div class="line">sudo python setup.py install</div>
</div><!-- fragment --><p>The module helloModule.so will end up in /usr/local/lib/python2.7/dist-packages/crappy2-X.X.X-py2.7-linux-x86_64.egg/crappy2/technical and a helloModule.py file will be created to allow the import of the module:</p>
<div class="fragment"><div class="line">def __bootstrap__():</div>
<div class="line">    global __bootstrap__, __loader__, __file__</div>
<div class="line">    import sys, pkg_resources, imp</div>
<div class="line">    __file__ = pkg_resources.resource_filename(__name__, <span class="stringliteral">&#39;helloModule.so&#39;</span>)</div>
<div class="line">    __loader__ = None; del __bootstrap__, __loader__</div>
<div class="line">    imp.load_dynamic(__name__,__file__)</div>
<div class="line">__bootstrap__()</div>
</div><!-- fragment --><p>So we can now simply use our module: </p>
<div class="fragment"><div class="line">In [1]: <span class="keyword">import</span> crappy2</div>
<div class="line">In [2]: crappy2.technical.helloModule.hello(<span class="stringliteral">&quot;Crappy&quot;</span>)</div>
<div class="line"><a class="code" href="structHello.html">Hello</a> Crappy</div>
</div><!-- fragment --><h2>A more oriented oject module </h2>
<p>Let try to define a class that is similar to the following python class:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span><a class="code" href="structHello.html">Hello</a>:</div>
<div class="line"></div>
<div class="line">    def __init__(self, name=&quot;Crappy&quot;):</div>
<div class="line">        self.name = name</div>
<div class="line"></div>
<div class="line">    def say_hello(self):</div>
<div class="line">        print &#39;hello &#39;, self.name</div>
<div class="line"></div>
<div class="line">    def get_name(self):</div>
<div class="line">        return self.name</div>
</div><!-- fragment --><p>we first need to define the functions to construct our future class:</p>
<ul>
<li>a new method</li>
<li>a constructor</li>
<li>a destructor And a structure which will contain the class attributes.</li>
</ul>
<p><br/>
Here, the struct contains two elements. The first, PyObject_HEAD must be always defined, it represent the type of object. The second element represent our attribute 'name'.</p>
<div class="fragment"><div class="line"><span class="comment">// define a struct to build our Python module, this is similar to the dict of a Python class.</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    PyObject_HEAD</div>
<div class="line">    <span class="keywordtype">char</span> *<a class="code" href="structHello.html#ac3f16fb061fbdc63eca1cab82734fcdb">name</a>;</div>
<div class="line">} <a class="code" href="structHello.html">Hello</a>;</div>
</div><!-- fragment --><p>The new method parse the arguments and keywords arguments, to initialize the structure defined before, which will be passed as first argument for each method (similar to the python self).</p>
<div class="fragment"><div class="line"><span class="comment">// This function will be called at the creation of our Python class, it allocates memory, parse the arguments and return</span></div>
<div class="line"><span class="comment">// the self struct.</span></div>
<div class="line"><span class="keyword">static</span> PyObject *Hello_new(PyTypeObject *type, PyObject *args, PyObject *kwds)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="structHello.html">Hello</a> *<span class="keyword">self</span>;</div>
<div class="line">    <span class="keyword">self</span> = (<a class="code" href="structHello.html">Hello</a> *)type-&gt;tp_alloc(type, 0);</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">char</span> *kwlist[] = {<span class="stringliteral">&quot;name&quot;</span>, NULL};</div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">self</span> != NULL) {</div>
<div class="line">        <span class="keywordflow">if</span> (! PyArg_ParseTupleAndKeywords(args, kwds, <span class="stringliteral">&quot;|s&quot;</span>, kwlist, &amp;self-&gt;name)){</div>
<div class="line">                <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> (PyObject *)<span class="keyword">self</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The constructor parses the arguments and keywords arguments. The "name" argument is optional: "|s" string or nothing; name is set by default to "Crappy". </p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> Hello_init(<a class="code" href="structHello.html">Hello</a> *<span class="keyword">self</span>, PyObject *args, PyObject *kwds)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">char</span> *kwlist[] = {<span class="stringliteral">&quot;name&quot;</span>, NULL};</div>
<div class="line"></div>
<div class="line">    <span class="keyword">self</span>-&gt;name = <span class="stringliteral">&quot;Crappy&quot;</span>;</div>
<div class="line">    <span class="keywordflow">if</span> (! PyArg_ParseTupleAndKeywords(args, kwds, <span class="stringliteral">&quot;|s&quot;</span>, kwlist, &amp;self-&gt;name)){</div>
<div class="line">            <span class="keywordflow">return</span> NULL;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> Hello_dealloc(<a class="code" href="structHello.html">Hello</a>* <span class="keyword">self</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">self</span>-&gt;ob_type-&gt;tp_free((PyObject*)<span class="keyword">self</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p>We then define our two method like before:</p>
<dl class="section note"><dt>Note</dt><dd>To return a value, we need to use the Py_BuildValue function, to convert C++ type to python type: In this way, we directly get a understandable python object.</dd></dl>
<div class="fragment"><div class="line">PyObject*</div>
<div class="line"><a class="code" href="hello__class_8cpp.html#aff55f43f450f9739609a024d5e4c14db">Hello_get</a>(<a class="code" href="structHello.html">Hello</a> *<span class="keyword">self</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> Py_BuildValue(<span class="stringliteral">&quot;s&quot;</span>, self-&gt;name);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">PyObject*</div>
<div class="line"><a class="code" href="hello__class_8cpp.html#acd44ecc2ffb2565721770ab30f9c87e6">Hello_print</a>(<a class="code" href="structHello.html">Hello</a> *<span class="keyword">self</span>)</div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Hello &quot;</span> &lt;&lt; <span class="keyword">self</span>-&gt;name &lt;&lt; endl;</div>
<div class="line"></div>
<div class="line">    Py_RETURN_NONE;</div>
<div class="line">}</div>
</div><!-- fragment --><p>To define a class which can be bound with Python, we need to define the structure of it, with a PyTypeObject. We have to define:</p>
<ul>
<li>which function is the constructor</li>
<li>which one is the destructor, the new method...</li>
<li>what is the name of the class</li>
<li>its size</li>
<li>its methods</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">static</span> PyMethodDef Hello_methods[] = {</div>
<div class="line">        {<span class="stringliteral">&quot;say_hello&quot;</span>, (PyCFunction)<a class="code" href="hello__class_8cpp.html#acd44ecc2ffb2565721770ab30f9c87e6">Hello_print</a>, METH_NOARGS,</div>
<div class="line">     <span class="stringliteral">&quot;Say hello to somebody.&quot;</span>},</div>
<div class="line">     {<span class="stringliteral">&quot;get_name&quot;</span>, (PyCFunction)<a class="code" href="hello__class_8cpp.html#aff55f43f450f9739609a024d5e4c14db">Hello_get</a>, METH_NOARGS,</div>
<div class="line">     <span class="stringliteral">&quot;Return the name attribute.&quot;</span>},</div>
<div class="line">    {NULL}</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> PyMethodDef module_methods[] = {</div>
<div class="line">    {NULL}</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> PyTypeObject helloType = {</div>
<div class="line">    PyObject_HEAD_INIT(NULL)</div>
<div class="line">    0,                         <span class="comment">/*ob_size*/</span></div>
<div class="line">    <span class="stringliteral">&quot;Hello&quot;</span>,             <span class="comment">/*tp_name*/</span></div>
<div class="line">    <span class="keyword">sizeof</span>(<a class="code" href="structHello.html">Hello</a>),             <span class="comment">/*tp_basicsize*/</span></div>
<div class="line">    0,                         <span class="comment">/*tp_itemsize*/</span></div>
<div class="line">    (destructor)Hello_dealloc, <span class="comment">/*tp_dealloc*/</span></div>
<div class="line">    0,                         <span class="comment">/*tp_print*/</span></div>
<div class="line">    0,                         <span class="comment">/*tp_getattr*/</span></div>
<div class="line">    0,                         <span class="comment">/*tp_setattr*/</span></div>
<div class="line">    0,                         <span class="comment">/*tp_compare*/</span></div>
<div class="line">    0,                         <span class="comment">/*tp_repr*/</span></div>
<div class="line">    0,                         <span class="comment">/*tp_as_number*/</span></div>
<div class="line">    0,                         <span class="comment">/*tp_as_sequence*/</span></div>
<div class="line">    0,                         <span class="comment">/*tp_as_mapping*/</span></div>
<div class="line">    0,                         <span class="comment">/*tp_hash */</span></div>
<div class="line">    0,                         <span class="comment">/*tp_call*/</span></div>
<div class="line">    0,                         <span class="comment">/*tp_str*/</span></div>
<div class="line">    0,                         <span class="comment">/*tp_getattro*/</span></div>
<div class="line">    0,                         <span class="comment">/*tp_setattro*/</span></div>
<div class="line">    0,                         <span class="comment">/*tp_as_buffer*/</span></div>
<div class="line">    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_BASETYPE, <span class="comment">/*tp_flags*/</span></div>
<div class="line">    <span class="stringliteral">&quot;Hello objects&quot;</span>,           <span class="comment">/* tp_doc */</span></div>
<div class="line">    0,                     <span class="comment">/* tp_traverse */</span></div>
<div class="line">    0,                     <span class="comment">/* tp_clear */</span></div>
<div class="line">    0,                     <span class="comment">/* tp_richcompare */</span></div>
<div class="line">    0,                     <span class="comment">/* tp_weaklistoffset */</span></div>
<div class="line">    0,                     <span class="comment">/* tp_iter */</span></div>
<div class="line">    0,                     <span class="comment">/* tp_iternext */</span></div>
<div class="line">    Hello_methods,             <span class="comment">/* tp_methods */</span></div>
<div class="line">    0,             <span class="comment">/* tp_members */</span></div>
<div class="line">    0,                         <span class="comment">/* tp_getset */</span></div>
<div class="line">    0,                         <span class="comment">/* tp_base */</span></div>
<div class="line">    0,                         <span class="comment">/* tp_dict */</span></div>
<div class="line">    0,                         <span class="comment">/* tp_descr_get */</span></div>
<div class="line">    0,                         <span class="comment">/* tp_descr_set */</span></div>
<div class="line">    0,                         <span class="comment">/* tp_dictoffset */</span></div>
<div class="line">    (initproc)Hello_init,      <span class="comment">/* tp_init */</span></div>
<div class="line">    0,                         <span class="comment">/* tp_alloc */</span></div>
<div class="line">    Hello_new,                 <span class="comment">/* tp_new */</span></div>
<div class="line">};</div>
</div><!-- fragment --><p>Finally, as we did on the first example, the init method as to be defined: </p>
<pre class="fragment">Py_InitModule3 create the module and return its instance (here empty).
We can add our created objects, here helloType which defined our class.
</pre> <dl class="section note"><dt>Note</dt><dd>When returning an object, it returns a reference to it, each object has a reference counter this is made automatically for memory management issue, to know how many different places there are that have a reference to an object. When an object's reference count becomes 0, the object is automatically deallocated. This has to be made by yourself when dealing with C-C++/Python bindings. (With Py_INCREF, Py_DECREF). Please see Python C-api documentation for more details.</dd></dl>
<div class="fragment"><div class="line">PyMODINIT_FUNC</div>
<div class="line"><a class="code" href="hello_8cpp.html#a299f88d32b419fc587777a87d32b3797">inithelloModule</a>(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">try</span>{</div>
<div class="line">        PyObject* <a class="code" href="namespaceprotection.html#a79f083642df12eaf9c581bced1405a73">m</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (PyType_Ready(&amp;helloType) &lt; 0)</div>
<div class="line">            cout &lt;&lt; <span class="stringliteral">&quot;unable to install ximea module&quot;</span> &lt;&lt; endl;</div>
<div class="line"></div>
<div class="line">        m = Py_InitModule3(<span class="stringliteral">&quot;helloModule&quot;</span>, module_methods,</div>
<div class="line">                           <span class="stringliteral">&quot;hello C++ module.&quot;</span>);</div>
<div class="line"></div>
<div class="line">        Py_INCREF(&amp;helloType);</div>
<div class="line">        PyModule_AddObject(m, <span class="stringliteral">&quot;Hello&quot;</span>, (PyObject *)&amp;helloType);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span> ( <span class="keyword">const</span> std::exception &amp; e )</div>
<div class="line">    {</div>
<div class="line">        std::cerr &lt;&lt; e.what();</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Example:</p>
<div class="fragment"><div class="line">In [2]: hello = crappy2.technical.helloModule.Hello(<span class="stringliteral">&quot;world&quot;</span>)</div>
<div class="line"></div>
<div class="line">In [3]: hello.</div>
<div class="line">hello.get_name   hello.say_hello</div>
<div class="line"></div>
<div class="line">In [3]: hello.get_name()</div>
<div class="line">Out[3]: <span class="stringliteral">&#39;world&#39;</span></div>
<div class="line"></div>
<div class="line">In [4]: hello.say_hello()</div>
<div class="line"><a class="code" href="structHello.html">Hello</a> world</div>
<div class="line"></div>
<div class="line">In [5]: hello = crappy2.technical.helloModule.Hello()</div>
<div class="line"></div>
<div class="line">In [6]: hello.say_hello()</div>
<div class="line"><a class="code" href="structHello.html">Hello</a> Crappy</div>
<div class="line"></div>
<div class="line">In [7]: hello.get_name()</div>
<div class="line">Out[7]: <span class="stringliteral">&#39;Crappy&#39;</span></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
